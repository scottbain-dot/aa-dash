<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fuel Lab | Athlete Academy</title>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Clean light background */
        .bg-animated {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #f0f5f1;
            z-index: -2;
        }

        /* Main container */
        .main-container {
            min-height: 100vh;
            padding: 20px;
            position: relative;
        }

        /* Welcome Screen - Green theme for nutrition */
        .welcome-screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            text-align: center;
            padding: 40px 20px;
            background: linear-gradient(135deg, #2d5a3d, #3d7a4f, #4a9960);
        }

        .welcome-logo {
            font-size: 80px;
            margin-bottom: 20px;
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .welcome-title {
            font-size: clamp(2.5rem, 6vw, 4rem);
            font-weight: 800;
            background: linear-gradient(135deg, #90EE90, #98FB98, #90EE90);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }

        .welcome-subtitle {
            font-size: 1.2rem;
            color: rgba(255,255,255,0.85);
            margin-bottom: 40px;
        }

        .privacy-notice {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            padding: 15px 25px;
            margin-bottom: 30px;
            max-width: 500px;
        }

        .privacy-notice p {
            color: rgba(255,255,255,0.9);
            font-size: 0.9rem;
            line-height: 1.5;
        }

        /* Google Sign In Button */
        .g_id_signin {
            margin-top: 20px;
        }

        /* Loading States */
        .loading-container {
            display: none;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            margin-top: 30px;
        }

        .loading-container.active {
            display: flex;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 3px solid rgba(255,255,255,0.1);
            border-top-color: #90EE90;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-text {
            color: rgba(255,255,255,0.9);
            font-size: 0.95rem;
        }

        /* Portal (hidden until signed in) */
        .portal {
            display: none;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .portal.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Header */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 20px;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .header-logo {
            font-size: 2.5rem;
        }

        .header-title {
            font-size: 2rem;
            font-weight: 800;
            color: #1a1a1a;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
            color: #333;
        }

        .user-name {
            font-weight: 600;
        }

        .nav-btn {
            padding: 10px 20px;
            background: linear-gradient(135deg, #2d5a3d, #3d7a4f);
            border: none;
            border-radius: 10px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            text-decoration: none;
            transition: all 0.3s ease;
        }

        .nav-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(45, 90, 61, 0.3);
        }

        /* Progress Overview Card */
        .progress-card {
            background: white;
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }

        .progress-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: #1a1a1a;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .progress-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
        }

        .progress-item {
            background: #f8faf8;
            border-radius: 12px;
            padding: 15px;
            text-align: center;
            border: 2px solid transparent;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .progress-item:hover {
            border-color: #3d7a4f;
            transform: translateY(-2px);
        }

        .progress-item.completed {
            background: linear-gradient(135deg, rgba(45, 90, 61, 0.1), rgba(61, 122, 79, 0.05));
            border-color: #3d7a4f;
        }

        .progress-item-icon {
            font-size: 2rem;
            margin-bottom: 8px;
        }

        .progress-item-title {
            font-weight: 600;
            color: #1a1a1a;
            margin-bottom: 5px;
        }

        .progress-item-status {
            font-size: 0.85rem;
            color: #666;
        }

        .progress-item-level {
            display: inline-block;
            padding: 4px 12px;
            background: #e8f5e9;
            color: #2d5a3d;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-top: 8px;
        }

        /* Phase Navigation */
        .phase-nav {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .phase-btn {
            padding: 12px 24px;
            border: 2px solid #ddd;
            background: white;
            border-radius: 25px;
            font-weight: 600;
            color: #666;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .phase-btn:hover {
            border-color: #3d7a4f;
            color: #3d7a4f;
        }

        .phase-btn.active {
            background: linear-gradient(135deg, #2d5a3d, #3d7a4f);
            border-color: #2d5a3d;
            color: white;
        }

        .phase-btn.locked {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Content Sections */
        .content-section {
            display: none;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }

        .content-section.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #1a1a1a;
            margin-bottom: 10px;
        }

        .section-subtitle {
            color: #666;
            margin-bottom: 25px;
        }

        /* Video Module */
        .video-module {
            margin-bottom: 30px;
            padding-bottom: 30px;
            border-bottom: 1px solid #eee;
        }

        .video-module:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        .video-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: #1a1a1a;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .video-container {
            position: relative;
            width: 100%;
            max-width: 800px;
            padding-bottom: 56.25%;
            height: 0;
            border-radius: 12px;
            overflow: hidden;
            background: #000;
            margin-bottom: 20px;
        }

        .video-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: none;
        }

        .video-complete-btn {
            padding: 12px 24px;
            background: linear-gradient(135deg, #2d5a3d, #3d7a4f);
            border: none;
            border-radius: 10px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .video-complete-btn:hover {
            transform: translateY(-2px);
        }

        .video-complete-btn.completed {
            background: #e8f5e9;
            color: #2d5a3d;
        }

        /* Quiz Section */
        .quiz-container {
            background: #f8faf8;
            border-radius: 15px;
            padding: 25px;
            margin-top: 20px;
        }

        .quiz-question {
            font-size: 1.1rem;
            font-weight: 600;
            color: #1a1a1a;
            margin-bottom: 20px;
        }

        .quiz-options {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .quiz-option {
            padding: 15px 20px;
            background: white;
            border: 2px solid #ddd;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .quiz-option:hover {
            border-color: #3d7a4f;
        }

        .quiz-option.selected {
            border-color: #3d7a4f;
            background: #e8f5e9;
        }

        .quiz-option.correct {
            border-color: #22c55e;
            background: #dcfce7;
        }

        .quiz-option.incorrect {
            border-color: #ef4444;
            background: #fee2e2;
        }

        .quiz-feedback {
            margin-top: 15px;
            padding: 15px;
            border-radius: 10px;
            display: none;
        }

        .quiz-feedback.show {
            display: block;
        }

        .quiz-feedback.correct {
            background: #dcfce7;
            color: #166534;
        }

        .quiz-feedback.incorrect {
            background: #fee2e2;
            color: #991b1b;
        }

        /* Fact or Cap Game */
        .fact-or-cap {
            text-align: center;
            padding: 20px;
        }

        .foc-card {
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 600px;
            margin: 0 auto 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
        }

        .foc-statement {
            font-size: 1.4rem;
            font-weight: 600;
            color: #1a1a1a;
            margin-bottom: 30px;
            line-height: 1.5;
        }

        .foc-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
        }

        .foc-btn {
            padding: 20px 50px;
            border: none;
            border-radius: 15px;
            font-size: 1.2rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .foc-btn.fact {
            background: linear-gradient(135deg, #22c55e, #16a34a);
            color: white;
        }

        .foc-btn.cap {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
        }

        .foc-btn:hover {
            transform: scale(1.05);
        }

        .foc-result {
            display: none;
            padding: 25px;
            border-radius: 15px;
            margin-top: 20px;
        }

        .foc-result.show {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        .foc-result.correct {
            background: #dcfce7;
        }

        .foc-result.incorrect {
            background: #fee2e2;
        }

        .foc-result-icon {
            font-size: 3rem;
            margin-bottom: 10px;
        }

        .foc-explanation {
            font-size: 1rem;
            color: #333;
            line-height: 1.6;
        }

        .foc-next-btn {
            margin-top: 20px;
            padding: 12px 30px;
            background: #333;
            color: white;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
        }

        .foc-progress {
            margin-bottom: 20px;
            color: #666;
        }

        .foc-score {
            font-size: 1.5rem;
            font-weight: 700;
            color: #2d5a3d;
            margin-bottom: 20px;
        }

        /* Athlete Fuel Modules */
        .module-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .module-card {
            background: #f8faf8;
            border-radius: 15px;
            padding: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .module-card:hover {
            border-color: #3d7a4f;
            transform: translateY(-3px);
        }

        .module-card.completed {
            border-color: #22c55e;
            background: linear-gradient(135deg, rgba(34, 197, 94, 0.1), rgba(22, 163, 74, 0.05));
        }

        .module-card.locked {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .module-icon {
            font-size: 2.5rem;
            margin-bottom: 15px;
        }

        .module-name {
            font-size: 1.1rem;
            font-weight: 700;
            color: #1a1a1a;
            margin-bottom: 8px;
        }

        .module-desc {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 15px;
        }

        .module-status {
            display: inline-block;
            padding: 5px 12px;
            background: #e8f5e9;
            color: #2d5a3d;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        /* Meal Plan Builder */
        .meal-plan-builder {
            padding: 20px 0;
        }

        .scenario-selection {
            margin-bottom: 30px;
        }

        .scenario-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .scenario-card {
            background: #f8faf8;
            border: 2px solid #ddd;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .scenario-card:hover {
            border-color: #3d7a4f;
        }

        .scenario-card.selected {
            border-color: #2d5a3d;
            background: #e8f5e9;
        }

        .scenario-card.completed {
            border-color: #22c55e;
            background: linear-gradient(135deg, rgba(34, 197, 94, 0.15), rgba(22, 163, 74, 0.08));
        }

        .scenario-icon {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .scenario-name {
            font-weight: 700;
            color: #1a1a1a;
            margin-bottom: 5px;
        }

        .scenario-desc {
            font-size: 0.85rem;
            color: #666;
        }

        /* Meal Timeline Builder */
        .meal-timeline {
            display: none;
            margin-top: 30px;
        }

        .meal-timeline.active {
            display: block;
        }

        .timeline-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .timeline-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: #1a1a1a;
        }

        .timeline-container {
            position: relative;
            padding: 20px 0;
        }

        .timeline-line {
            position: absolute;
            left: 30px;
            top: 0;
            bottom: 0;
            width: 4px;
            background: linear-gradient(to bottom, #e8f5e9, #2d5a3d, #e8f5e9);
            border-radius: 2px;
        }

        .meal-slot {
            display: flex;
            gap: 20px;
            margin-bottom: 25px;
            position: relative;
        }

        .meal-time {
            width: 60px;
            height: 60px;
            background: white;
            border: 3px solid #2d5a3d;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            color: #2d5a3d;
            font-size: 0.85rem;
            z-index: 1;
            flex-shrink: 0;
        }

        .meal-content {
            flex: 1;
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .meal-label {
            font-weight: 600;
            color: #1a1a1a;
            margin-bottom: 10px;
        }

        .meal-input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 1rem;
            font-family: inherit;
            transition: border-color 0.3s ease;
        }

        .meal-input:focus {
            outline: none;
            border-color: #3d7a4f;
        }

        .meal-tips {
            margin-top: 10px;
            padding: 10px;
            background: #f0f5f1;
            border-radius: 8px;
            font-size: 0.85rem;
            color: #666;
        }

        .save-plan-btn {
            display: block;
            width: 100%;
            max-width: 400px;
            margin: 30px auto 0;
            padding: 15px 30px;
            background: linear-gradient(135deg, #2d5a3d, #3d7a4f);
            border: none;
            border-radius: 12px;
            color: white;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .save-plan-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(45, 90, 61, 0.3);
        }

        /* Saved Plans View */
        .saved-plans {
            margin-top: 30px;
        }

        .saved-plan-card {
            background: #f8faf8;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
            border-left: 4px solid #2d5a3d;
        }

        .saved-plan-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .saved-plan-title {
            font-weight: 700;
            color: #1a1a1a;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .saved-plan-meals {
            display: grid;
            gap: 10px;
        }

        .saved-meal {
            display: flex;
            gap: 15px;
            align-items: flex-start;
        }

        .saved-meal-time {
            font-weight: 600;
            color: #2d5a3d;
            min-width: 80px;
        }

        .saved-meal-content {
            color: #333;
        }

        /* Toast Notifications */
        .toast {
            position: fixed;
            bottom: 30px;
            right: 30px;
            padding: 15px 25px;
            background: #333;
            color: white;
            border-radius: 10px;
            font-weight: 500;
            z-index: 1000;
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.3s ease;
        }

        .toast.show {
            transform: translateY(0);
            opacity: 1;
        }

        .toast.success {
            background: linear-gradient(135deg, #22c55e, #16a34a);
        }

        .toast.error {
            background: linear-gradient(135deg, #ef4444, #dc2626);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                text-align: center;
            }

            .header-title {
                font-size: 1.5rem;
            }

            .phase-nav {
                justify-content: center;
            }

            .foc-buttons {
                flex-direction: column;
            }

            .foc-btn {
                padding: 15px 30px;
            }

            .timeline-line {
                left: 20px;
            }

            .meal-time {
                width: 45px;
                height: 45px;
                font-size: 0.75rem;
            }
        }
    </style>
</head>
<body>
    <div class="bg-animated"></div>

    <div class="main-container">
        <!-- Welcome Screen -->
        <div class="welcome-screen" id="welcomeScreen">
            <div class="welcome-logo">ü•ó</div>
            <h1 class="welcome-title">Fuel Lab</h1>
            <p class="welcome-subtitle">Master the science of athlete nutrition</p>
            
            <div class="privacy-notice">
                <p>üîí Sign in with your school Google account to track your progress and create personalized meal plans.</p>
            </div>

            <div id="g_id_onload"
                data-client_id="YOUR_GOOGLE_CLIENT_ID"
                data-context="signin"
                data-ux_mode="popup"
                data-callback="handleCredentialResponse"
                data-auto_prompt="false">
            </div>

            <div class="g_id_signin"
                data-type="standard"
                data-shape="rectangular"
                data-theme="filled_black"
                data-text="signin_with"
                data-size="large"
                data-logo_alignment="left">
            </div>

            <div class="loading-container" id="loadingContainer">
                <div class="spinner"></div>
                <div class="loading-text">Setting up your Fuel Lab...</div>
            </div>
        </div>

        <!-- Main Portal -->
        <div class="portal" id="portal">
            <!-- Header -->
            <header class="header">
                <div class="header-left">
                    <span class="header-logo">ü•ó</span>
                    <h1 class="header-title">Fuel Lab</h1>
                </div>
                <div class="header-right">
                    <div class="user-info">
                        <span class="user-name" id="userName">Athlete</span>
                        <span>‚Üí</span>
                    </div>
                    <a href="strength-portal.html" class="nav-btn">üí™ Strength Portal</a>
                </div>
            </header>

            <!-- Progress Overview -->
            <div class="progress-card">
                <h2 class="progress-title">üéØ Your Progress</h2>
                <div class="progress-grid">
                    <div class="progress-item" data-phase="foundations">
                        <div class="progress-item-icon">üìö</div>
                        <div class="progress-item-title">Foundations</div>
                        <div class="progress-item-status">3 videos</div>
                        <div class="progress-item-level" id="foundationsLevel">Level 0</div>
                    </div>
                    <div class="progress-item" data-phase="mythbusting">
                        <div class="progress-item-icon">üß¢</div>
                        <div class="progress-item-title">Fact or Cap</div>
                        <div class="progress-item-status">Myth busting</div>
                        <div class="progress-item-level" id="mythLevel">Level 0</div>
                    </div>
                    <div class="progress-item" data-phase="athlete">
                        <div class="progress-item-icon">‚ö°</div>
                        <div class="progress-item-title">Athlete Fuel</div>
                        <div class="progress-item-status">5 modules</div>
                        <div class="progress-item-level" id="athleteLevel">Level 0</div>
                    </div>
                    <div class="progress-item" data-phase="planning">
                        <div class="progress-item-icon">üìã</div>
                        <div class="progress-item-title">Meal Planning</div>
                        <div class="progress-item-status">Create plans</div>
                        <div class="progress-item-level" id="planningLevel">Level 0</div>
                    </div>
                </div>
            </div>

            <!-- Phase Navigation -->
            <div class="phase-nav">
                <button class="phase-btn active" data-phase="foundations">üìö Foundations</button>
                <button class="phase-btn" data-phase="mythbusting">üß¢ Fact or Cap</button>
                <button class="phase-btn" data-phase="athlete">‚ö° Athlete Fuel</button>
                <button class="phase-btn" data-phase="planning">üìã Meal Planning</button>
            </div>

            <!-- Phase 1: Foundations -->
            <section class="content-section active" id="foundationsSection">
                <h2 class="section-title">üìö Nutrition Foundations</h2>
                <p class="section-subtitle">Watch each video and answer the questions to build your base knowledge.</p>

                <!-- Video 1 -->
                <div class="video-module" id="video1Module">
                    <h3 class="video-title">
                        <span>1Ô∏è‚É£</span>
                        What is Food? - Part 1
                    </h3>
                    <div class="video-container">
                        <iframe src="https://www.loom.com/embed/440fa39a30394d14a48f0d90ed300d8d" allowfullscreen></iframe>
                    </div>
                    <button class="video-complete-btn" onclick="markVideoComplete(1)">
                        ‚úì I've watched this video
                    </button>

                    <div class="quiz-container" id="quiz1" style="display: none;">
                        <div class="quiz-question">What are the three main macronutrients?</div>
                        <div class="quiz-options">
                            <div class="quiz-option" onclick="selectAnswer(1, 0)">Vitamins, Minerals, Water</div>
                            <div class="quiz-option" onclick="selectAnswer(1, 1)">Carbohydrates, Proteins, Fats</div>
                            <div class="quiz-option" onclick="selectAnswer(1, 2)">Fiber, Sugar, Salt</div>
                            <div class="quiz-option" onclick="selectAnswer(1, 3)">Calories, Energy, Nutrients</div>
                        </div>
                        <div class="quiz-feedback" id="feedback1"></div>
                    </div>
                </div>

                <!-- Video 2 -->
                <div class="video-module" id="video2Module">
                    <h3 class="video-title">
                        <span>2Ô∏è‚É£</span>
                        What is Food? - Part 2
                    </h3>
                    <div class="video-container">
                        <iframe src="https://www.loom.com/embed/f2202193bc0c47888850cbb2252abc2a" allowfullscreen></iframe>
                    </div>
                    <button class="video-complete-btn" onclick="markVideoComplete(2)">
                        ‚úì I've watched this video
                    </button>

                    <div class="quiz-container" id="quiz2" style="display: none;">
                        <div class="quiz-question">Which macronutrient is the body's preferred energy source?</div>
                        <div class="quiz-options">
                            <div class="quiz-option" onclick="selectAnswer(2, 0)">Protein</div>
                            <div class="quiz-option" onclick="selectAnswer(2, 1)">Fat</div>
                            <div class="quiz-option" onclick="selectAnswer(2, 2)">Carbohydrates</div>
                            <div class="quiz-option" onclick="selectAnswer(2, 3)">Vitamins</div>
                        </div>
                        <div class="quiz-feedback" id="feedback2"></div>
                    </div>
                </div>

                <!-- Video 3 -->
                <div class="video-module" id="video3Module">
                    <h3 class="video-title">
                        <span>3Ô∏è‚É£</span>
                        What is a Healthy Diet?
                    </h3>
                    <div class="video-container">
                        <iframe src="https://www.loom.com/embed/9d71f8bf4362480aa646e454b551d9ae" allowfullscreen></iframe>
                    </div>
                    <button class="video-complete-btn" onclick="markVideoComplete(3)">
                        ‚úì I've watched this video
                    </button>

                    <div class="quiz-container" id="quiz3" style="display: none;">
                        <div class="quiz-question">A balanced diet should include a variety of foods from all food groups. True or False?</div>
                        <div class="quiz-options">
                            <div class="quiz-option" onclick="selectAnswer(3, 0)">True</div>
                            <div class="quiz-option" onclick="selectAnswer(3, 1)">False</div>
                        </div>
                        <div class="quiz-feedback" id="feedback3"></div>
                    </div>
                </div>
            </section>

            <!-- Phase: Fact or Cap (Myth Busting) -->
            <section class="content-section" id="mythbustingSection">
                <h2 class="section-title">üß¢ Fact or Cap?</h2>
                <p class="section-subtitle">Test your nutrition knowledge. Can you spot the myths?</p>

                <div class="fact-or-cap" id="focGame">
                    <div class="foc-progress">Question <span id="focCurrent">1</span> of <span id="focTotal">10</span></div>
                    <div class="foc-score" id="focScore" style="display: none;"></div>

                    <div class="foc-card" id="focCard">
                        <div class="foc-statement" id="focStatement">Loading...</div>
                        <div class="foc-buttons" id="focButtons">
                            <button class="foc-btn fact" onclick="answerFoC(true)">‚úì FACT</button>
                            <button class="foc-btn cap" onclick="answerFoC(false)">‚úó CAP</button>
                        </div>
                        <div class="foc-result" id="focResult">
                            <div class="foc-result-icon" id="focResultIcon"></div>
                            <div class="foc-explanation" id="focExplanation"></div>
                            <button class="foc-next-btn" onclick="nextFoC()">Next ‚Üí</button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Phase: Athlete Fuel Science -->
            <section class="content-section" id="athleteSection">
                <h2 class="section-title">‚ö° Athlete Fuel Science</h2>
                <p class="section-subtitle">Learn how nutrition specifically impacts athletic performance.</p>

                <div class="module-grid">
                    <div class="module-card" onclick="openModule('timing')">
                        <div class="module-icon">‚è∞</div>
                        <div class="module-name">Meal Timing</div>
                        <div class="module-desc">When to eat around training and competition</div>
                        <div class="module-status" id="timingStatus">Not started</div>
                    </div>

                    <div class="module-card" onclick="openModule('recovery')">
                        <div class="module-icon">üîÑ</div>
                        <div class="module-name">Recovery Nutrition</div>
                        <div class="module-desc">Fuel your body to repair and grow stronger</div>
                        <div class="module-status" id="recoveryStatus">Not started</div>
                    </div>

                    <div class="module-card" onclick="openModule('hydration')">
                        <div class="module-icon">üíß</div>
                        <div class="module-name">Hydration</div>
                        <div class="module-desc">Why water matters for performance</div>
                        <div class="module-status" id="hydrationStatus">Not started</div>
                    </div>

                    <div class="module-card" onclick="openModule('macros')">
                        <div class="module-icon">üß±</div>
                        <div class="module-name">Macros for Athletes</div>
                        <div class="module-desc">Protein, carbs, and fats for performance</div>
                        <div class="module-status" id="macrosStatus">Not started</div>
                    </div>

                    <div class="module-card" onclick="openModule('sleep')">
                        <div class="module-icon">üò¥</div>
                        <div class="module-name">Sleep & Nutrition</div>
                        <div class="module-desc">How food and rest work together</div>
                        <div class="module-status" id="sleepStatus">Not started</div>
                    </div>
                </div>
            </section>

            <!-- Phase: Meal Planning -->
            <section class="content-section" id="planningSection">
                <h2 class="section-title">üìã Meal Plan Builder</h2>
                <p class="section-subtitle">Create personalized nutrition plans for different scenarios. Choose 2 to complete.</p>

                <div class="meal-plan-builder">
                    <div class="scenario-selection">
                        <h3 style="margin-bottom: 10px; color: #1a1a1a;">Choose Your Scenarios</h3>
                        <p style="color: #666; font-size: 0.95rem;">Select 2 scenarios to build meal plans for:</p>
                        
                        <div class="scenario-grid">
                            <div class="scenario-card" onclick="selectScenario('competition')" id="scenarioCompetition">
                                <div class="scenario-icon">üèÜ</div>
                                <div class="scenario-name">Competition Day</div>
                                <div class="scenario-desc">Big event or tournament</div>
                            </div>

                            <div class="scenario-card" onclick="selectScenario('training')" id="scenarioTraining">
                                <div class="scenario-icon">üèãÔ∏è</div>
                                <div class="scenario-name">Training Day</div>
                                <div class="scenario-desc">Practice or workout day</div>
                            </div>

                            <div class="scenario-card" onclick="selectScenario('gameday')" id="scenarioGameday">
                                <div class="scenario-icon">‚öΩ</div>
                                <div class="scenario-name">Regular Game Day</div>
                                <div class="scenario-desc">Weekly match or game</div>
                            </div>

                            <div class="scenario-card" onclick="selectScenario('rest')" id="scenarioRest">
                                <div class="scenario-icon">üõãÔ∏è</div>
                                <div class="scenario-name">Rest Day</div>
                                <div class="scenario-desc">Recovery and regeneration</div>
                            </div>
                        </div>
                    </div>

                    <!-- Meal Timeline Builder -->
                    <div class="meal-timeline" id="mealTimeline">
                        <div class="timeline-header">
                            <h3 class="timeline-title" id="timelineTitle">Building plan for: Competition Day</h3>
                            <button class="nav-btn" onclick="closeTimeline()" style="background: #666;">‚Üê Back</button>
                        </div>

                        <div class="timeline-container">
                            <div class="timeline-line"></div>

                            <div class="meal-slot">
                                <div class="meal-time">7:00<br>AM</div>
                                <div class="meal-content">
                                    <div class="meal-label">üåÖ Breakfast</div>
                                    <textarea class="meal-input" id="meal-breakfast" placeholder="What will you eat for breakfast?" rows="2"></textarea>
                                    <div class="meal-tips" id="tips-breakfast">üí° Tip: Focus on complex carbs and moderate protein</div>
                                </div>
                            </div>

                            <div class="meal-slot">
                                <div class="meal-time">10:00<br>AM</div>
                                <div class="meal-content">
                                    <div class="meal-label">üçé Mid-Morning Snack</div>
                                    <textarea class="meal-input" id="meal-snack1" placeholder="Light snack ideas..." rows="2"></textarea>
                                    <div class="meal-tips" id="tips-snack1">üí° Tip: Keep it light - fruit or small handful of nuts</div>
                                </div>
                            </div>

                            <div class="meal-slot">
                                <div class="meal-time">12:30<br>PM</div>
                                <div class="meal-content">
                                    <div class="meal-label">üçΩÔ∏è Lunch</div>
                                    <textarea class="meal-input" id="meal-lunch" placeholder="Your lunch plan..." rows="2"></textarea>
                                    <div class="meal-tips" id="tips-lunch">üí° Tip: Balanced meal with carbs, protein, and vegetables</div>
                                </div>
                            </div>

                            <div class="meal-slot">
                                <div class="meal-time">3:00<br>PM</div>
                                <div class="meal-content">
                                    <div class="meal-label">‚ö° Pre-Activity Fuel</div>
                                    <textarea class="meal-input" id="meal-pre" placeholder="What to eat 1-2 hours before..." rows="2"></textarea>
                                    <div class="meal-tips" id="tips-pre">üí° Tip: Easy to digest carbs, avoid high fat/fiber</div>
                                </div>
                            </div>

                            <div class="meal-slot">
                                <div class="meal-time">6:00<br>PM</div>
                                <div class="meal-content">
                                    <div class="meal-label">üîÑ Post-Activity Recovery</div>
                                    <textarea class="meal-input" id="meal-post" placeholder="Recovery nutrition within 30-60 mins..." rows="2"></textarea>
                                    <div class="meal-tips" id="tips-post">üí° Tip: Combine protein + carbs for optimal recovery</div>
                                </div>
                            </div>

                            <div class="meal-slot">
                                <div class="meal-time">7:30<br>PM</div>
                                <div class="meal-content">
                                    <div class="meal-label">üåô Dinner</div>
                                    <textarea class="meal-input" id="meal-dinner" placeholder="Evening meal plan..." rows="2"></textarea>
                                    <div class="meal-tips" id="tips-dinner">üí° Tip: Complete protein, lots of vegetables, quality carbs</div>
                                </div>
                            </div>
                        </div>

                        <button class="save-plan-btn" onclick="saveMealPlan()">
                            üíæ Save This Meal Plan
                        </button>
                    </div>

                    <!-- Saved Plans -->
                    <div class="saved-plans" id="savedPlans">
                        <h3 style="margin-bottom: 15px; color: #1a1a1a;">üìÅ Your Saved Plans</h3>
                        <div id="savedPlansList">
                            <p style="color: #666;">No saved plans yet. Create your first one above!</p>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </div>

    <!-- Toast Notification -->
    <div class="toast" id="toast"></div>

    <script>
        // ============================================
        // CONFIGURATION
        // ============================================
        const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycby631f9BK6umgW2C4kA1Uew4Mdi8ebWzL-olpb0Co7OEheeAPA3LrxDyJbqQ2Xpabrs/exec';
        const GOOGLE_CLIENT_ID = '799307975498-2t9hua4gjhf13gfpgd13hkbqnmvfj3r1.apps.googleusercontent.com';

        // ============================================
        // USER STATE
        // ============================================
        let currentUser = {
            email: null,
            name: null,
            athleteId: null
        };

        let userProgress = {
            videosWatched: [],
            quizzesCompleted: [],
            focScore: 0,
            focCompleted: false,
            modulesCompleted: [],
            mealPlans: {}
        };

        // ============================================
        // QUIZ DATA
        // ============================================
        const quizAnswers = {
            1: { correct: 1, feedback: 'Correct! Carbohydrates, Proteins, and Fats are the three macronutrients that provide energy.' },
            2: { correct: 2, feedback: 'Correct! Carbohydrates are the body\'s preferred and most efficient source of energy.' },
            3: { correct: 0, feedback: 'Correct! A balanced diet includes variety from all food groups to ensure you get all necessary nutrients.' }
        };

        // ============================================
        // FACT OR CAP DATA
        // ============================================
        const focQuestions = [
            {
                statement: "Energy drinks are a good way to hydrate before a game.",
                isFact: false,
                explanation: "CAP! Energy drinks are high in sugar and caffeine, which can actually dehydrate you. Water or sports drinks are much better choices for hydration."
            },
            {
                statement: "Eating protein after a workout helps your muscles recover and grow.",
                isFact: true,
                explanation: "FACT! Protein provides amino acids that your muscles need to repair and grow stronger after exercise."
            },
            {
                statement: "Skipping breakfast helps you lose weight and perform better.",
                isFact: false,
                explanation: "CAP! Skipping breakfast can leave you low on energy, hurt your concentration, and actually slow down your metabolism."
            },
            {
                statement: "You should drink water before you feel thirsty.",
                isFact: true,
                explanation: "FACT! By the time you feel thirsty, you're already slightly dehydrated. Regular sipping throughout the day is best."
            },
            {
                statement: "Carbs are bad for you and should be avoided.",
                isFact: false,
                explanation: "CAP! Carbohydrates are your body's main fuel source, especially important for athletes. Choose complex carbs like whole grains."
            },
            {
                statement: "Chocolate milk can be a good recovery drink after exercise.",
                isFact: true,
                explanation: "FACT! Chocolate milk has a good ratio of carbs to protein, plus fluids and electrolytes - perfect for recovery!"
            },
            {
                statement: "You need protein supplements to build muscle.",
                isFact: false,
                explanation: "CAP! Most people, including athletes, can get enough protein from regular food. Supplements aren't necessary for most."
            },
            {
                statement: "Eating a big meal right before training helps give you energy.",
                isFact: false,
                explanation: "CAP! Eating too much before exercise can cause stomach issues. Have a small snack 1-2 hours before, not a big meal."
            },
            {
                statement: "Sleep affects how well your body uses the food you eat.",
                isFact: true,
                explanation: "FACT! Poor sleep can mess with hormones that control hunger and how your body processes nutrients."
            },
            {
                statement: "Athletes need to eat differently on rest days compared to training days.",
                isFact: true,
                explanation: "FACT! Your body has different needs on rest days - still important to eat well, but you might need fewer calories and can focus more on recovery foods."
            }
        ];

        let focIndex = 0;
        let focCorrect = 0;

        // ============================================
        // GOOGLE SIGN-IN
        // ============================================
        function handleCredentialResponse(response) {
            const loadingContainer = document.getElementById('loadingContainer');
            loadingContainer.classList.add('active');

            const data = parseJwt(response.credential);
            currentUser.email = data.email;
            currentUser.name = data.name || data.email.split('@')[0];

            document.getElementById('userName').textContent = currentUser.name;

            // Fetch athlete data and initialize portal
            fetchAthleteData(currentUser.email).then(() => {
                loadingContainer.classList.remove('active');
                document.getElementById('welcomeScreen').style.display = 'none';
                document.getElementById('portal').classList.add('active');
                loadUserProgress();
                initFoC();
            });
        }

        function parseJwt(token) {
            const base64Url = token.split('.')[1];
            const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
            const jsonPayload = decodeURIComponent(atob(base64).split('').map(c =>
                '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2)
            ).join(''));
            return JSON.parse(jsonPayload);
        }

        async function fetchAthleteData(email) {
            try {
                const response = await fetch(`${APPS_SCRIPT_URL}?action=getAthleteData&email=${encodeURIComponent(email)}`);
                const data = await response.json();
                if (data.authenticated && data.athlete) {
                    currentUser.athleteId = data.athlete.Athlete_ID;
                }
            } catch (error) {
                console.error('Error fetching athlete data:', error);
            }
        }

        // ============================================
        // PROGRESS TRACKING
        // ============================================
        function loadUserProgress() {
            // Load from localStorage for now (can connect to Google Sheets later)
            const saved = localStorage.getItem(`fuellab_progress_${currentUser.email}`);
            if (saved) {
                userProgress = JSON.parse(saved);
                updateProgressDisplay();
            }
        }

        function saveUserProgress() {
            localStorage.setItem(`fuellab_progress_${currentUser.email}`, JSON.stringify(userProgress));
            updateProgressDisplay();
        }

        function updateProgressDisplay() {
            // Foundations level
            const videosComplete = userProgress.videosWatched.length;
            const quizzesComplete = userProgress.quizzesCompleted.length;
            let foundationsLevel = 0;
            if (videosComplete >= 1) foundationsLevel = 1;
            if (videosComplete >= 2 && quizzesComplete >= 1) foundationsLevel = 2;
            if (videosComplete >= 3 && quizzesComplete >= 3) foundationsLevel = 3;
            document.getElementById('foundationsLevel').textContent = `Level ${foundationsLevel}`;

            // Myth level
            let mythLevel = 0;
            if (userProgress.focCompleted) {
                if (userProgress.focScore >= 8) mythLevel = 3;
                else if (userProgress.focScore >= 5) mythLevel = 2;
                else mythLevel = 1;
            }
            document.getElementById('mythLevel').textContent = `Level ${mythLevel}`;

            // Athlete level
            const modulesComplete = userProgress.modulesCompleted.length;
            let athleteLevel = Math.min(modulesComplete, 5);
            document.getElementById('athleteLevel').textContent = `Level ${athleteLevel}`;

            // Planning level
            const plansComplete = Object.keys(userProgress.mealPlans).length;
            let planningLevel = Math.min(plansComplete, 2);
            document.getElementById('planningLevel').textContent = `Level ${planningLevel}`;

            // Update completed states
            userProgress.videosWatched.forEach(v => {
                const btn = document.querySelector(`#video${v}Module .video-complete-btn`);
                if (btn) {
                    btn.classList.add('completed');
                    btn.textContent = '‚úì Completed';
                }
            });

            // Update module statuses
            userProgress.modulesCompleted.forEach(m => {
                const status = document.getElementById(`${m}Status`);
                if (status) {
                    status.textContent = 'Completed ‚úì';
                    status.style.background = '#dcfce7';
                    status.style.color = '#166534';
                }
            });

            // Update scenario cards
            Object.keys(userProgress.mealPlans).forEach(scenario => {
                const card = document.getElementById(`scenario${capitalizeFirst(scenario)}`);
                if (card) {
                    card.classList.add('completed');
                }
            });

            // Render saved plans
            renderSavedPlans();
        }

        function capitalizeFirst(str) {
            return str.charAt(0).toUpperCase() + str.slice(1);
        }

        // ============================================
        // PHASE NAVIGATION
        // ============================================
        document.querySelectorAll('.phase-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const phase = btn.dataset.phase;
                
                // Update buttons
                document.querySelectorAll('.phase-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');

                // Update sections
                document.querySelectorAll('.content-section').forEach(s => s.classList.remove('active'));
                document.getElementById(`${phase}Section`).classList.add('active');
            });
        });

        // Progress items also navigate
        document.querySelectorAll('.progress-item').forEach(item => {
            item.addEventListener('click', () => {
                const phase = item.dataset.phase;
                document.querySelector(`.phase-btn[data-phase="${phase}"]`).click();
            });
        });

        // ============================================
        // VIDEO & QUIZ HANDLING
        // ============================================
        function markVideoComplete(videoNum) {
            if (!userProgress.videosWatched.includes(videoNum)) {
                userProgress.videosWatched.push(videoNum);
                saveUserProgress();
            }
            
            // Show quiz
            document.getElementById(`quiz${videoNum}`).style.display = 'block';
            
            showToast('Video marked as watched! Now answer the question.', 'success');
        }

        function selectAnswer(quizNum, answerIndex) {
            const options = document.querySelectorAll(`#quiz${quizNum} .quiz-option`);
            const feedback = document.getElementById(`feedback${quizNum}`);
            const correctIndex = quizAnswers[quizNum].correct;

            options.forEach((opt, i) => {
                opt.classList.remove('selected', 'correct', 'incorrect');
                if (i === answerIndex) {
                    if (i === correctIndex) {
                        opt.classList.add('correct');
                        feedback.className = 'quiz-feedback show correct';
                        feedback.textContent = '‚úì ' + quizAnswers[quizNum].feedback;
                        
                        if (!userProgress.quizzesCompleted.includes(quizNum)) {
                            userProgress.quizzesCompleted.push(quizNum);
                            saveUserProgress();
                        }
                    } else {
                        opt.classList.add('incorrect');
                        options[correctIndex].classList.add('correct');
                        feedback.className = 'quiz-feedback show incorrect';
                        feedback.textContent = '‚úó Not quite. ' + quizAnswers[quizNum].feedback;
                    }
                }
            });
        }

        // ============================================
        // FACT OR CAP GAME
        // ============================================
        function initFoC() {
            focIndex = 0;
            focCorrect = 0;
            showFoCQuestion();
        }

        function showFoCQuestion() {
            if (focIndex >= focQuestions.length) {
                showFoCResults();
                return;
            }

            const q = focQuestions[focIndex];
            document.getElementById('focCurrent').textContent = focIndex + 1;
            document.getElementById('focTotal').textContent = focQuestions.length;
            document.getElementById('focStatement').textContent = q.statement;
            document.getElementById('focButtons').style.display = 'flex';
            document.getElementById('focResult').classList.remove('show');
        }

        function answerFoC(answeredFact) {
            const q = focQuestions[focIndex];
            const isCorrect = answeredFact === q.isFact;
            
            if (isCorrect) focCorrect++;

            document.getElementById('focButtons').style.display = 'none';
            document.getElementById('focResult').classList.add('show');
            document.getElementById('focResult').className = `foc-result show ${isCorrect ? 'correct' : 'incorrect'}`;
            document.getElementById('focResultIcon').textContent = isCorrect ? '‚úì' : '‚úó';
            document.getElementById('focExplanation').textContent = q.explanation;
        }

        function nextFoC() {
            focIndex++;
            showFoCQuestion();
        }

        function showFoCResults() {
            userProgress.focScore = focCorrect;
            userProgress.focCompleted = true;
            saveUserProgress();

            document.getElementById('focCard').innerHTML = `
                <div class="foc-result-icon">üéâ</div>
                <div class="foc-score">You scored ${focCorrect} out of ${focQuestions.length}!</div>
                <p style="color: #666; margin-bottom: 20px;">
                    ${focCorrect >= 8 ? 'Amazing! You really know your nutrition facts!' : 
                      focCorrect >= 5 ? 'Good job! You\'ve got solid nutrition knowledge.' : 
                      'Keep learning! Review the foundations to boost your score.'}
                </p>
                <button class="foc-next-btn" onclick="initFoC()">Play Again</button>
            `;
        }

        // ============================================
        // ATHLETE MODULES
        // ============================================
        function openModule(moduleName) {
            // For now, mark as complete when clicked (will add actual content later)
            if (!userProgress.modulesCompleted.includes(moduleName)) {
                userProgress.modulesCompleted.push(moduleName);
                saveUserProgress();
                showToast(`${capitalizeFirst(moduleName)} module completed!`, 'success');
            }
        }

        // ============================================
        // MEAL PLAN BUILDER
        // ============================================
        let selectedScenarios = [];
        let currentScenario = null;

        function selectScenario(scenario) {
            const card = document.getElementById(`scenario${capitalizeFirst(scenario)}`);
            
            // If already completed, view it
            if (userProgress.mealPlans[scenario]) {
                showToast('You\'ve already completed this plan! View it below.', 'success');
                return;
            }

            // Open timeline for this scenario
            currentScenario = scenario;
            document.getElementById('timelineTitle').textContent = `Building plan for: ${getScenarioName(scenario)}`;
            document.getElementById('mealTimeline').classList.add('active');
            
            // Update tips based on scenario
            updateMealTips(scenario);
            
            // Clear inputs
            document.querySelectorAll('.meal-input').forEach(input => input.value = '');
        }

        function getScenarioName(scenario) {
            const names = {
                competition: 'üèÜ Competition Day',
                training: 'üèãÔ∏è Training Day',
                gameday: '‚öΩ Regular Game Day',
                rest: 'üõãÔ∏è Rest Day'
            };
            return names[scenario] || scenario;
        }

        function updateMealTips(scenario) {
            const tips = {
                competition: {
                    breakfast: 'üí° Focus on familiar foods - nothing new on competition day!',
                    snack1: 'üí° Light and easy to digest - banana or small energy bar',
                    lunch: 'üí° Moderate portion, high carb, low fat - pasta with light sauce',
                    pre: 'üí° 2-3 hours before: easily digestible carbs like toast with jam',
                    post: 'üí° Recovery shake or chocolate milk within 30 minutes',
                    dinner: 'üí° Celebrate but refuel! Quality protein and plenty of carbs'
                },
                training: {
                    breakfast: 'üí° Solid breakfast with complex carbs and protein',
                    snack1: 'üí° Fruit and yogurt or handful of nuts',
                    lunch: 'üí° Balanced meal - rice/pasta, chicken/fish, vegetables',
                    pre: 'üí° 1-2 hours before: banana, toast, or small bowl of oatmeal',
                    post: 'üí° Protein + carbs within 45 mins - eggs on toast, protein shake',
                    dinner: 'üí° Complete meal to support recovery and next day\'s training'
                },
                gameday: {
                    breakfast: 'üí° Easy to digest - oatmeal, toast, fruit',
                    snack1: 'üí° Keep it light if game is midday',
                    lunch: 'üí° If game is later: normal balanced lunch 3-4 hours before',
                    pre: 'üí° Small carb-rich snack 1-2 hours before kickoff',
                    post: 'üí° Start recovery immediately - banana, sports drink',
                    dinner: 'üí° Post-game meal: replenish with carbs, protein, vegetables'
                },
                rest: {
                    breakfast: 'üí° Protein-rich to support muscle repair',
                    snack1: 'üí° Optional - listen to your hunger',
                    lunch: 'üí° Normal balanced meal, slightly smaller portions',
                    pre: 'üí° N/A for rest day - focus on overall nutrition',
                    post: 'üí° N/A for rest day',
                    dinner: 'üí° Quality protein, lots of colorful vegetables'
                }
            };

            const scenarioTips = tips[scenario] || tips.training;
            document.getElementById('tips-breakfast').textContent = scenarioTips.breakfast;
            document.getElementById('tips-snack1').textContent = scenarioTips.snack1;
            document.getElementById('tips-lunch').textContent = scenarioTips.lunch;
            document.getElementById('tips-pre').textContent = scenarioTips.pre;
            document.getElementById('tips-post').textContent = scenarioTips.post;
            document.getElementById('tips-dinner').textContent = scenarioTips.dinner;
        }

        function closeTimeline() {
            document.getElementById('mealTimeline').classList.remove('active');
            currentScenario = null;
        }

        function saveMealPlan() {
            if (!currentScenario) return;

            const plan = {
                scenario: currentScenario,
                meals: {
                    breakfast: document.getElementById('meal-breakfast').value,
                    snack1: document.getElementById('meal-snack1').value,
                    lunch: document.getElementById('meal-lunch').value,
                    pre: document.getElementById('meal-pre').value,
                    post: document.getElementById('meal-post').value,
                    dinner: document.getElementById('meal-dinner').value
                },
                savedAt: new Date().toISOString()
            };

            // Validate - at least 3 meals filled
            const filledMeals = Object.values(plan.meals).filter(m => m.trim()).length;
            if (filledMeals < 3) {
                showToast('Please fill in at least 3 meals to save your plan.', 'error');
                return;
            }

            userProgress.mealPlans[currentScenario] = plan;
            saveUserProgress();

            showToast('Meal plan saved! üéâ', 'success');
            closeTimeline();
        }

        function renderSavedPlans() {
            const container = document.getElementById('savedPlansList');
            const plans = userProgress.mealPlans;

            if (Object.keys(plans).length === 0) {
                container.innerHTML = '<p style="color: #666;">No saved plans yet. Create your first one above!</p>';
                return;
            }

            let html = '';
            for (const [scenario, plan] of Object.entries(plans)) {
                html += `
                    <div class="saved-plan-card">
                        <div class="saved-plan-header">
                            <div class="saved-plan-title">${getScenarioName(scenario)}</div>
                        </div>
                        <div class="saved-plan-meals">
                            ${plan.meals.breakfast ? `<div class="saved-meal"><span class="saved-meal-time">Breakfast:</span><span class="saved-meal-content">${plan.meals.breakfast}</span></div>` : ''}
                            ${plan.meals.snack1 ? `<div class="saved-meal"><span class="saved-meal-time">Snack:</span><span class="saved-meal-content">${plan.meals.snack1}</span></div>` : ''}
                            ${plan.meals.lunch ? `<div class="saved-meal"><span class="saved-meal-time">Lunch:</span><span class="saved-meal-content">${plan.meals.lunch}</span></div>` : ''}
                            ${plan.meals.pre ? `<div class="saved-meal"><span class="saved-meal-time">Pre-Activity:</span><span class="saved-meal-content">${plan.meals.pre}</span></div>` : ''}
                            ${plan.meals.post ? `<div class="saved-meal"><span class="saved-meal-time">Post-Activity:</span><span class="saved-meal-content">${plan.meals.post}</span></div>` : ''}
                            ${plan.meals.dinner ? `<div class="saved-meal"><span class="saved-meal-time">Dinner:</span><span class="saved-meal-content">${plan.meals.dinner}</span></div>` : ''}
                        </div>
                    </div>
                `;
            }
            container.innerHTML = html;
        }

        // ============================================
        // TOAST NOTIFICATIONS
        // ============================================
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = `toast show ${type}`;
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // ============================================
        // DEV MODE - Auto login for testing
        // ============================================
        function devLogin() {
            currentUser.email = 'test@student.edu';
            currentUser.name = 'Test Student';
            currentUser.athleteId = 1;
            
            document.getElementById('userName').textContent = currentUser.name;
            document.getElementById('welcomeScreen').style.display = 'none';
            document.getElementById('portal').classList.add('active');
            loadUserProgress();
            initFoC();
        }

        // Uncomment for testing without Google Sign-In:
        // document.addEventListener('DOMContentLoaded', devLogin);
    </script>
</body>
</html>
